##### Core #####

# Prefix / leader
unbind C-b
unbind C-Space
set -g prefix C-Space
bind C-Space send-prefix

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display-message "tmux.conf reloaded"

# True color + undercurl support
set -g default-terminal "tmux-256color"
set -as terminal-features ",xterm-256color:RGB,usstyle"

# Sensible defaults
set -g history-limit 100000
set -s escape-time 0
set -g display-time 2000
set -g renumber-windows on
set -g base-index 1
set -g set-clipboard on
set -g mouse on

# Rename version-numbered binaries (e.g. claude's "2.1.49") to something readable
set -g automatic-rename on
set -g automatic-rename-format '#{?#{m:[0-9]*.[0-9]*,#{pane_current_command}},claude,#{pane_current_command}}'

##### Splits (cwd-aware) #####

unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

##### Seamless vim-tmux navigation (Ctrl+h/j/k/l) #####

is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# Clear terminal (Ctrl+L is taken by nav above)
bind C-l send-keys C-l

# Prefix pane nav (fallback)
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# Resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

##### Layouts #####

# Cycle layouts (already default on prefix Space, but explicit)
bind Space next-layout

# Quick layouts: editor + terminal below, or side-by-side
bind M-1 select-layout main-vertical    # big left, stacked right
bind M-2 select-layout main-horizontal  # big top, stacked bottom
bind M-3 select-layout tiled            # equal grid
bind M-4 select-layout even-horizontal  # equal columns
bind M-5 select-layout even-vertical    # equal rows

# Zoom toggle (maximize current pane, press again to restore)
# Already default: prefix z

# Balance all panes equally
bind = select-layout tiled

##### Windows #####

unbind c
bind t new-window
bind n select-window -n
bind p select-window -p

##### Copy mode (vi) #####

set -g mode-keys vi
bind Escape copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy'

##### Status bar (tokyonight-night) #####

# Colors
TN_BG="#1a1b26"
TN_FG="#c0caf5"
TN_BLUE="#7aa2f7"
TN_CYAN="#7dcfff"
TN_COMMENT="#565f89"

set -g status on
set -g status-style "bg=#{TN_BG},fg=#{TN_COMMENT}"
set -g status-justify left

# Left: empty
set -g status-left ''

# Windows
set -g window-status-format         "#[fg=#{TN_COMMENT}] #I:#W "
set -g window-status-current-format "#[fg=#{TN_BLUE},bold] #I:#W "

# Right: dir + git (branch/tag/sha with distinct icons)
set -g status-right-length 80
set -g status-right "#[fg=#{TN_FG}] #(basename \"#{pane_current_path}\") #[fg=#{TN_CYAN}]#(cd \"#{pane_current_path}\" 2>/dev/null && { b=$(git symbolic-ref --short HEAD 2>/dev/null) && echo \" $b\"; } || { t=$(git describe --tags --exact-match 2>/dev/null) && echo \" $t\"; } || { s=$(git rev-parse --short HEAD 2>/dev/null) && echo \" $s\"; }) "

# Borders
set -g pane-border-style "fg=#{TN_COMMENT}"
set -g pane-active-border-style "fg=#{TN_BLUE}"

# Toggle status
bind b set -g status
